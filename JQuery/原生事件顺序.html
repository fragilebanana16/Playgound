<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµè§ˆå™¨äº‹ä»¶é¡ºåºæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .log-container {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 5px;
            height: 400px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.6;
        }
        .log-item {
            margin: 5px 0;
            padding: 3px 0;
        }
        .event-loading { color: #ff9800; }
        .event-interactive { color: #2196F3; }
        .event-dom { color: #4CAF50; font-weight: bold; }
        .event-complete { color: #9C27B0; }
        .event-load { color: #F44336; font-weight: bold; }
        .timestamp { color: #888; font-size: 12px; }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
        .info {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .img-container {
            margin: 20px 0;
        }
        .test-img {
            max-width: 300px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” æµè§ˆå™¨åŸç”Ÿäº‹ä»¶é¡ºåºæµ‹è¯•</h1>
    
    <div class="info">
        <strong>è¯´æ˜ï¼š</strong>æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹ä¸‹æ–¹æ—¥å¿—åŒºåŸŸï¼Œè§‚å¯Ÿå„äº‹ä»¶è§¦å‘çš„å…ˆåé¡ºåºã€‚åˆ·æ–°é¡µé¢(F5)å¯é‡æ–°æµ‹è¯•ã€‚
    </div>

    <div class="controls">
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <button onclick="location.reload()">åˆ·æ–°é¡µé¢</button>
        <button onclick="testBeforeUnload()">æµ‹è¯• beforeunload</button>
    </div>

    <div class="log-container" id="logContainer"></div>

    <div class="img-container">
        <h3>æµ‹è¯•å›¾ç‰‡ï¼ˆç”¨äºæµ‹è¯• load äº‹ä»¶ï¼‰</h3>
        <img class="test-img" src="https://via.placeholder.com/300x200/4CAF50/ffffff?text=Test+Image" alt="æµ‹è¯•å›¾ç‰‡" id="testImg">
    </div>

    <script>
        // ==================== æ—¥å¿—ç³»ç»Ÿ ====================
        let startTime = performance.now();
        let eventLog = [];

        function log(message, className = '') {
            const timestamp = (performance.now() - startTime).toFixed(2);
            const logItem = {
                time: timestamp,
                message: message,
                className: className
            };
            eventLog.push(logItem);
            
            const logContainer = document.getElementById('logContainer');
            const logElement = document.createElement('div');
            logElement.className = `log-item ${className}`;
            logElement.innerHTML = `<span class="timestamp">[${timestamp}ms]</span> ${message}`;
            logContainer.appendChild(logElement);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°
            console.log(`[${timestamp}ms] ${message}`);
        }

        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
            eventLog = [];
            startTime = performance.now();
            log('ğŸ“ æ—¥å¿—å·²æ¸…ç©º', '');
        }

        function testBeforeUnload() {
            alert('ç‚¹å‡»ç¡®å®šåï¼Œå°è¯•å…³é—­æˆ–åˆ·æ–°é¡µé¢ï¼Œä¼šçœ‹åˆ° beforeunload æç¤º');
            window.addEventListener('beforeunload', function(e) {
                e.preventDefault();
                e.returnValue = '';
            }, { once: true });
        }

        // ==================== åˆå§‹çŠ¶æ€ ====================
        log('ğŸš€ è„šæœ¬å¼€å§‹æ‰§è¡Œ', '');
        log(`ğŸ“„ å½“å‰ readyState: ${document.readyState}`, 'event-loading');

        // ==================== 1. readystatechange äº‹ä»¶ ====================
        document.addEventListener('readystatechange', function() {
            const state = document.readyState;
            let className = '';
            let emoji = '';
            
            if (state === 'loading') {
                className = 'event-loading';
                emoji = 'â³';
            } else if (state === 'interactive') {
                className = 'event-interactive';
                emoji = 'ğŸ”„';
            } else if (state === 'complete') {
                className = 'event-complete';
                emoji = 'âœ…';
            }
            
            log(`${emoji} readystatechange â†’ ${state}`, className);
        });

        // ==================== 2. DOMContentLoaded äº‹ä»¶ ====================
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ¯ DOMContentLoaded è§¦å‘ (DOM æ ‘æ„å»ºå®Œæˆ)', 'event-dom');
            log(`   â†’ readyState: ${document.readyState}`, 'event-dom');
            log(`   â†’ å¯ä»¥å®‰å…¨æ“ä½œ DOM å…ƒç´ äº†`, 'event-dom');
            
            // æµ‹è¯• DOM è®¿é—®
            const img = document.getElementById('testImg');
            if (img) {
                log(`   â†’ å›¾ç‰‡å…ƒç´ å¯è®¿é—®: âœ“`, 'event-dom');
                log(`   â†’ å›¾ç‰‡å®½åº¦: ${img.width || 0} (å¯èƒ½è¿˜æœªåŠ è½½)`, 'event-dom');
            }
        });

        // ==================== 3. window.load äº‹ä»¶ ====================
        window.addEventListener('load', function() {
            log('ğŸ”¥ window.load è§¦å‘ (æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ)', 'event-load');
            log(`   â†’ readyState: ${document.readyState}`, 'event-load');
            
            // æµ‹è¯•å›¾ç‰‡å°ºå¯¸
            const img = document.getElementById('testImg');
            if (img) {
                log(`   â†’ å›¾ç‰‡å®½åº¦: ${img.width} (çœŸå®å°ºå¯¸)`, 'event-load');
                log(`   â†’ å›¾ç‰‡é«˜åº¦: ${img.height}`, 'event-load');
            }
            
            // æ˜¾ç¤ºæ€»ç»“
            setTimeout(() => {
                log('', '');
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', '');
                log('ğŸ“Š äº‹ä»¶è§¦å‘é¡ºåºæ€»ç»“:', '');
                log('1. readystatechange (loading)', 'event-loading');
                log('2. readystatechange (interactive)', 'event-interactive');
                log('3. DOMContentLoaded', 'event-dom');
                log('4. readystatechange (complete)', 'event-complete');
                log('5. window.load', 'event-load');
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', '');
            }, 100);
        });

        // ==================== 4. beforeunload äº‹ä»¶ ====================
        window.addEventListener('beforeunload', function(e) {
            log('âš ï¸ beforeunload è§¦å‘ (å³å°†ç¦»å¼€é¡µé¢)', '');
            console.log('âš ï¸ beforeunload è§¦å‘ - é¡µé¢å³å°†å¸è½½');
        });

        // ==================== 5. unload äº‹ä»¶ ====================
        window.addEventListener('unload', function() {
            console.log('ğŸ‘‹ unload è§¦å‘ - é¡µé¢å·²å¸è½½');
            // æ³¨æ„ï¼šunload æ—¶ DOM å¯èƒ½å·²ç»ä¸å¯ç”¨ï¼Œæ‰€ä»¥åªç”¨ console.log
        });

        // ==================== 6. æµ‹è¯•å›¾ç‰‡çš„ load äº‹ä»¶ ====================
        const testImg = document.getElementById('testImg');
        if (testImg) {
            testImg.addEventListener('load', function() {
                log(`ğŸ–¼ï¸ å›¾ç‰‡ load äº‹ä»¶è§¦å‘ (å•ä¸ªå›¾ç‰‡åŠ è½½å®Œæˆ)`, '');
                log(`   â†’ å›¾ç‰‡å°ºå¯¸: ${this.width} x ${this.height}`, '');
            });
            
            testImg.addEventListener('error', function() {
                log(`âŒ å›¾ç‰‡åŠ è½½å¤±è´¥`, '');
            });
        }

        // ==================== é¡µé¢ visibility å˜åŒ– ====================
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                log('ğŸ‘ï¸ é¡µé¢éšè— (åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾)', '');
            } else {
                log('ğŸ‘ï¸ é¡µé¢å¯è§ (åˆ‡æ¢å›å½“å‰æ ‡ç­¾)', '');
            }
        });

        // ==================== è„šæœ¬ç»“æŸ ====================
        log('âœ¨ è„šæœ¬æ‰§è¡Œå®Œæ¯•ï¼Œç­‰å¾…äº‹ä»¶è§¦å‘...', '');
        log('', '');
    </script>

    <!-- é¢å¤–çš„æµ‹è¯•èµ„æº -->
    <script>
        // è®°å½•è„šæœ¬æ‰§è¡Œä½ç½®
        log('ğŸ“ ç¬¬äºŒä¸ª script æ ‡ç­¾æ‰§è¡Œ', '');
    </script>
</body>
</html>